<!DOCTYPE html>
<html lang="ko">
<html xmlns:th="http://www.thymeleaf.org">

<head>
	<meta charset="UTF-8">
	<title th:text="|${pageName}|"></title>
	<!-- jQuery 라이브러리를 포함합니다 -->
	<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>

<body>
	<div>
		<h1><a th:href="|/${loginType}|">[[${pageName}]]</a></h1>
		<hr />
		<h2>회원 가입</h2>
		<form id="joinForm" th:method="post" th:action="|@{/{loginType}/join (loginType=${loginType})}|"
			th:object="${joinRequest}">
			<div>
				<label th:for="loginId">로그인 아이디 : </label>
				<input type="text" th:field="*{userid}" th:errorclass="error-input" />
				<div class="error-class" th:errors="*{userid}"></div>
			</div>
			<br />
			<div>
				<label th:for="password">비밀번호 : </label>
				<input type="password" th:field="*{password}" th:errorclass="error-input" />
				<div class="error-class" th:errors="*{password}"></div>
			</div>
			<br />
			<div>
				<label th:for="passwordCheck">비밀번호 체크 : </label>
				<input type="password" th:field="*{passwordCheck}" th:errorclass="error-input" />
				<div class "error-class" th:errors="*{passwordCheck}"></div>
			</div>
			<br />
			<div>
				<label th:for="nickname">닉네임 : </label>
				<input type="text" th:field="*{nickname}" th:errorclass="error-input" />
				<div class="error-class" th:errors="*{nickname}"></div>
			</div>
			<br />
			<div id="imguploads">
				<label for="img">프로필 이미지:</label>
				<input type="file" />
				<img id="previewImage" src="" alt="Image Preview" style="max-width: 100px; max-height: 100px;" />
			</div>
			<button type="submit" id="joinButton">회원 가입</button>
		</form>
	</div>

</body>


</html>

<style>
	.error-class {
		color: red;
	}

	.error-input {
		border-color: red;
	}
</style>

<script>
	$(document).ready(function () {
		const imageInput = $('input[type="file"]');
		const previewImage = $('#previewImage');
		const joinButton = $('#joinButton');


		imageInput.on("change", function () {
			// 이미지를 선택하면 미리보기 이미지를 설정합니다.
			const file = imageInput[0].files[0];
			const imageUrl = URL.createObjectURL(file);

			previewImage.attr('src', imageUrl);

			const formData = new FormData();
			formData.append('file', file);

			$.ajax({
				url: "/security-login/upload",
				type: "POST",
				data: formData,
				processData: false,
				contentType: false,
				success: function (uniqueFileName) {
					
					const imgField = $('<input>', {type: "hidden", name: "img", value: uniqueFileName});
					$('#imguploads').append(imgField);
				}
			});
		});
	});


</script>