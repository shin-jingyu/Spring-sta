<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">

<head>
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/css/bootstrap.min.css" rel="stylesheet"
		integrity="sha384-4bw+/aepP/YC94hEpVNVgiZdgIC5+VKNBQNGCHeKRQN+PtmoHDEXuppvnDJzQIu9" crossorigin="anonymous">
	<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/js/bootstrap.bundle.min.js"
		integrity="sha384-HwwvtgBNo3bZJJLYd8oVXjrBZt8cqVSpeBNS5n7C8IVInixGAoxmnlMuBnhbgrkm"
		crossorigin="anonymous"></script>

	<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

	<meta charset="UTF-8">

	
</head>

<body>
	<div class="container">
		<table class="table table-bordered">
			<thead>
				<tr>
					<th class="col-md-1">번호</th>
					<th class="col-md-1">제목</th>
					<th class="col-md-1">작성자</th>
					<th class="col-md-1">작성일</th>
				</tr>
			</thead>
			<tbody id="boardTableBody">
			</tbody>
		</table>

		<!-- Modal -->
		<button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#Modal"
			data-bs-whatever="@mdo">글작성</button>

		<div class="modal fade" id="Modal" tabindex="-1" aria-labelledby="ModalLabel" aria-hidden="true">
			<div class="modal-dialog">
				<div class="modal-content">
					<div class="modal-header">
						<h1 class="modal-title fs-5" id="ModalLabel">글작성</h1>
						<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
					</div>
					<div class="modal-body">
						<form id="createForm" method="post" action="/api/board">
							<div class="mb-3">
								<label for="title" class="col-form-label">제목:</label>
								<input type="text" class="form-control" name="title" id="title" required>
							</div>
							<div class="mb-3">
								<label for="content" class="col-form-label">내용:</label>
								<textarea class="form-control" name="content" id="content" required></textarea>
							</div>
						</form>
					</div>
					<div class="modal-footer">
						<button type="button" id="createButton" class="btn btn-primary">업로드</button>
					</div>
				</div>
			</div>
		</div>
		
		 <div class="modal fade" id="detailModal" tabindex="-1" aria-labelledby="detailModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h1 class="modal-title fs-5" id="detailModalLabel">글 상세보기</h1>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <!-- 상세 내용을 여기에 채웁니다. -->
                </div>
            </div>
        </div>
    </div>
		
		
	</div>

	
</body>

</html>
<script>
    $(document).ready(function () {
        var apiURL = '/api/board';
        var boardTableBody = $('#boardTableBody');
        var createModal = $('#Modal'); // 글 작성 모달
        var detailModal = $('#detailModal'); // 상세보기 모달

        // 글 작성 폼 처리
        $('#createButton').on('click', function () {
            $.ajax({
                url: apiURL,
                method: 'POST',
                contentType: 'application/json',
                data: JSON.stringify({
                    title: $('#title').val(),
                    content: $('#content').val()
                }),
                success: function (response) {
                    // 글 작성 성공 시 모달 닫기
                    createModal.modal('hide');
                    // 목록 업데이트
                    updateBoardList();
                }
            });
        });

        function showDetail(boardid) {
            $.get(apiURL + '/' + boardid, function (data) {
                // Modal 내용을 채우기
                detailModal.find('.modal-body').html(`
                    <p><strong>제목:</strong> ${data.title}</p>
                    <p><strong>내용:</strong> ${data.content}</p>
                    <p><strong>작성자:</strong> ${data.nickname}</p>
                    <p><strong>작성일:</strong> ${data.createdAt}</p>
                `);
                detailModal.modal('show');
            });
        }

        // Modal 열기 버튼 클릭 이벤트 핸들러
        boardTableBody.on('click', '.show-details', function () {
            var boardid = $(this).data('boardid');
            showDetail(boardid);
        });

        function updateBoardList() {
            $.get(apiURL, function (data) {
                boardTableBody.empty(); // 목록 초기화

                data.forEach(function (item) {
                    boardTableBody.append(`
                        <tr>
                            <td>${item.boardid}</td>
                            <td><a href="#" class="show-details" data-boardid="${item.boardid}">${item.title}</a></td>
                            <td>${item.nickname}</td>
                            <td>${item.createdAt}</td>
                        </tr>
                    `);
                });
            });
        }

        updateBoardList(); // 페이지 로드 시 목록 업데이트
    });
</script>