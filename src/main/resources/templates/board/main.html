<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">

<head>

	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/css/bootstrap.min.css" rel="stylesheet"
		integrity="sha384-4bw+/aepP/YC94hEpVNVgiZdgIC5+VKNBQNGCHeKRQN+PtmoHDEXuppvnDJzQIu9" crossorigin="anonymous">
	<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/js/bootstrap.bundle.min.js"
		integrity="sha384-HwwvtgBNo3bZJJLYd8oVXjrBZt8cqVSpeBNS5n7C8IVInixGAoxmnlMuBnhbgrkm"
		crossorigin="anonymous"></script>

	<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
	<link th:href="@{/css/main.css}" rel="stylesheet">
	<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">
	<meta charset="UTF-8">

</head>
<header>
	<div class="shadow" style="height: 100%; display: flex; justify-content: center; align-items: center;">
		<h1><i class="bi bi-star-half"></i> sta</h1>
	</div>
</header>

<body>
	<div class="containers ">

		<div class="sidebar">
			<div class="container " style="margin-top: 20%;">
				<ul class="list-group list-group-flush">
					</br>
					<a class="list-group-item" type="button" href="http://localhost:8080/board"
						style="background-color: #f0f0f0;">
						<h4><i class="bi bi-house-door-fill"></i> Home</h4>
					</a>
					</br>
					<a class="list-group-item" style="background-color: #f0f0f0;" data-bs-toggle="offcanvas"
						data-bs-target="#offcanvasScrolling" aria-controls="offcanvasScrolling">
						<h4><i class="bi bi-search"></i> 검색</h4>
					</a>
					</br>
					<a class="list-group-item" id="myPage" style=" background-color: #f0f0f0;">
						<h4>
							<img th:if="${img ne null}" th:src="${img}"
								style="width:50px ; height: 50px; border-radius: 50%; margin-right: 10px; border: 1px solid #000;">
							<img th:if="${img == null}" th:src="@{/uploads/final/main.jpg}"
								style=" width:50px ; height: 50px; border-radius: 50%; margin-right: 10px; border: 1px solid #000;">
							프로필
						</h4>
					</a>
					</br>

					<a class="list-group-item" style="background-color: #f0f0f0;" type="button" data-bs-toggle="modal"
						data-bs-target="#Modal" data-bs-whatever="@mdo">
						<h4><i class="bi bi-plus-square"></i> 글작성 </h4>
					</a>
					</br>
					<div class="dropdown">
						<a class="list-group-item " type="button" data-bs-toggle="dropdown" aria-expanded="false"
							style="background-color: #f0f0f0;">
							<h4><i class="bi bi-list"></i>더보기</h4>
						</a>
						<ul class="dropdown-menu">
							<li><a class="dropdown-item" href="/security-login/logout">
									<h5><i class="bi bi-person-fill-dash"></i> 로그아웃
								</a></h5>
							</li>
							<li><a class="dropdown-item" id="userupdate">
									<h5><i class="bi bi-person-bounding-box"></i> 회원정보</h5>
								</a></li>
							<li><a class="dropdown-item" id="userdelete">
									<h5><i class="bi bi-person-bounding-box"></i> 회원탈퇴</h5>
								</a></li>

						</ul>



					</div>
				</ul>
			</div>


			<div class="offcanvas offcanvas-start" data-bs-scroll="true" data-bs-backdrop="false" tabindex="-1"
				id="offcanvasScrolling" aria-labelledby="offcanvasScrollingLabel" style="width: 17%; margin-top: 5%;">
				<div class="offcanvas-header shadow">
					<h5 class="offcanvas-title" id="offcanvasScrollingLabel"><i class="bi bi-search"></i> search</h5>
					<button type="button" class="btn-close" data-bs-dismiss="offcanvas" aria-label="Close"></button>
				</div>
				<div class="offcanvas-body">
					<div class="input-group mb-3 shadow">
						<input type="text" class="form-control" id="search-input"
							aria-describedby="search-input-button">
						<button class="btn btn-outline-secondary" type="button" id="search-input-button">검색</button>
					</div>
					<div id="user-search">

					</div>
				</div>
			</div>

		</div>


		<div class="content" id="contentid">
			<div class="container">
				<div class="row">
					<div class="col-8">


						<div id="mainboard" class="container">

						</div>


						<!-- 글작성 모달 -->
						<div class="modal fade" id="Modal" tabindex="-1" aria-labelledby="ModalLabel"
							aria-hidden="true">
							<div class="modal-dialog">
								<div class="modal-content">
									<div class="modal-header">
										<h1 class="modal-title fs-5" id="ModalLabel">글작성</h1>
										<button type="button" class="btn-close" data-bs-dismiss="modal"
											aria-label="Close"></button>
									</div>

									<div class="modal-body">
										<div class="mb-3">
											<label for="content" class="col-form-label">사진:</label>
											<input id="boardfile" type="file" multiple>
											<div id="carouselExampleIndicators" class="carousel slide">
												<div id="carousel-inner" class="carousel-inner">
													<div id="imgdiv" class="carousel-item active" hidden>
														<img id="imagePreview1" class="d-block w-100"
															style="height: 300px; " src="">
														<input type="hidden" id="boardimg1" name="boardimg1" value="">
													</div>

												</div>


												<button class="carousel-control-prev" type="button"
													data-bs-target="#carouselExampleIndicators" data-bs-slide="prev">
													<span class="carousel-control-prev-icon" aria-hidden="true"></span>
													<span class="visually-hidden">Previous</span>
												</button>
												<button class="carousel-control-next" type="button"
													data-bs-target="#carouselExampleIndicators" data-bs-slide="next">
													<span class="carousel-control-next-icon" ariahidden="true"></span>
													<span class="visually-hidden">Next</span>
												</button>
											</div>

										</div>

										<div class="mb-3">
											<label for="content" class="col-form-label">내용:</label>
											<textarea class="form-control" id="content" required></textarea>
										</div>

									</div>


									<div class="modal-footer">
										<button type="button" id="createButton" class="btn btn-primary">업로드</button>
									</div>
								</div>
							</div>
						</div>

					</div>
					<div class="col-4">
						<div class="row">
							<div class="col">
								<div class="card">
									<div class="card-header">
										회원님을 위한 추천
									</div>
									<div class="card-body " id="friend">



									</div>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>


		</div>







		<div id="boardupdatemodal">

		</div>

	</div>

</body>

</html>

<script th:inline="javascript">
	$(document).ready(function () {
		// 서버 API의 URL 및 필요한 HTML 엘리먼트 가져오기
		const apiURL = '/api/board';
		const mainboard = $('#mainboard');
		const createModal = $('#Modal'); // 글 작성 모달
		let loggedInUserNickname = /*[[${nickname}]]*/'';
		let loggedInUserid = /*[[${id}]]*/'';
		let loginUser = /*[[${loginUser}]]*/'';
		const imageInput = $('#boardfile');
		const boardupdatemodal = $('#boardupdatemodal');
		const contentid = $('#contentid');
		const userdelete = $('#userdelete');
		const defaultImage = '/uploads/final/main.jpg';
		const modal2 = $('#modal2');
		const friend = $('#friend');

		recommend();
		function recommend() {
			$.ajax({
				url: '/security-login/userListAll',
				type: 'GET',
				contentType: 'application/json',

				success: function (userList) {
					friend.empty();
					const limit = 5; // 원하는 반복 횟수 설정
					for (let i = 0; i < Math.min(limit, userList.length); i++) {
						const userAll = userList[i];

						friend.append(`
				            <div id="row-follow-${userAll.id}" class="row shadow-sm m-4 d-flex align-items-center justify-content-center">
				                <div class="col-3">
				                    <img src="${userAll.img ? userAll.img : defaultImage}" style="width:45px; height:45px; border-radius:50%; margin-right:10px;">
				                </div>
				                <div class="col-6">
				                    <h5 class="card-title">${userAll.nickname}</h5>
				                    <h6 class="card-subtitle mb-2 text-body-secondary">${userAll.text ? userAll.text : ''}</h6>
				                </div>
				                <div class="col-3" id="follow-${userAll.id}">
				                    
				                </div>
				            </div>
				        `);
						const userfollow = $(`#follow-${userAll.id}`);
						const rowfollow = $(`#row-follow-${userAll.id}`);
						if (loginUser.userid === userAll.userid) {
							rowfollow.empty();
						} else {

							$.ajax({
								url: `/api/follow?myid=${loggedInUserid}&youid=${userAll.id}`,
								type: 'GET',
								success: function (follow) {
									if (follow == 2) {
										rowfollow.empty();
									} else if (follow == 1) {
										rowfollow.empty();
									} else {
										userfollow.append(`<p class="mb-0" id="follow-click-${userAll.id}"><a  class="link-primary align-items-center d-flex">팔로우</a></p>`);
									}
									$(`#follow-click-${userAll.id}`).on('click', function () {
										
										$.ajax({
											url: '/api/follow',
											type: 'POST',
											contentType: 'application/json',
											data: JSON.stringify({
												myid: loggedInUserid,
												youid: userAll.id,
												my_userid: loginUser.userid,
												you_userid: userAll.userid
											}),
											success: function (follow) {
													recommend();

											}
										});
									});
								}
							});
						}





					}



				}
			});
		}
		$('#search-input-button').on('click', function () {
			const userList = $('#user-search');
			let searchinput = $('#search-input').val();


			if (searchinput === "") {
				alert("검색어를 입력해주세요")
			} else {
				userList.empty();
				contentid.empty();
				$.ajax({
					url: apiURL + '/search?keyword=' + searchinput,
					type: 'GET',
					success: function (list) {

						contentid.append(`
							<div class="container " style="background-color: white; width:1000px;" >
								
								<div class="row ">
									<div class="col shadow">
										<a style="font-size: 40px;"><i class="bi bi-search"></i>search" ${searchinput} "</a>		
									</div>
								</div>
								
								<div class="row" id="searchGrid" style="background-color: white;"> 
									
								</div>
							  
							</div>
							
							`);
						const gridid = $('#searchGrid');
						list.forEach(function (boardLists) {

							const searchboardLists = [boardLists.boardimg1, boardLists.boardimg2, boardLists.boardimg3, boardLists.boardimg4, boardLists.boardimg5].filter(Boolean);
							gridid.append(`
								<div class="col-4 shadow" id="search-${boardLists.boardid}" data-bs-target="#search-modal-${boardLists.boardid}">
									<img src="${boardLists.boardimg1}" class="img-thumbnail" style="width:300px ; height: 300px; margin-bottom: 20px; margin-top: 20px;">
								</div>
								<div class="modal" id="search-modal-${boardLists.boardid}" tabindex="-1">
									<div class="modal-dialog modal-dialog-centered modal-xl">
										<div class="modal-content">
											
											<div class="modal-header">
												<h5 class="modal-title"><img src="${boardLists.img ? boardLists.img : defaultImage}" style="width:40px ; height: 40px; border-radius: 50%; margin-right: 10px;">${boardLists.nickname}</h5>
												<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
											</div>
											
											<div class="modal-body">
												<div class="container-fluid">
													<div class="row">
														<div class="col-md-7 ">
															
															<div class="row shadow">
																
																<div id="carousel-search-${boardLists.boardid}" class="carousel slide">
																	
																	<div class="carousel-inner">
																		${searchboardLists.map((imageUrl, index) => `
																		<div id="img-${index}" class="carousel-item ${index === 0 ? 'active' : ''}">
																			<img src="${imageUrl}" class="d-block w-100" style="height: 600px;"
																				alt="Image ${index + 1}">
																		</div>
																		`).join('')}
																	</div>
																	
																	<button class="carousel-control-prev" type="button"
																		data-bs-target="#carousel-search-${boardLists.boardid}" data-bs-slide="prev">
																		<span class="carousel-control-prev-icon" aria-hidden="true"></span>
																	</button>
																	
																	<button class="carousel-control-next" type="button"
																		data-bs-target="#carousel-search-${boardLists.boardid}" data-bs-slide="next">
																		<span class="carousel-control-next-icon" aria-hidden="true"></span>
																	</button>
																
																</div>
																
															</div>
															
															<div class="row shadow" style=" margin-bottom: 10px;margin-top: 10px;">
																<div id="search-like-${boardLists.boardid}" style="font-size: 2em;"></div>
																<div id="update-search-item-${boardLists.content}">
																	<a style="font-size: 2em;">${boardLists.content}</a>																
																</div>
															</div>
															
														</div>
														
														<div class="col-md-5">
															
															<div class="row  text-end" >
																
																<div class="dropdown" style="margin-bottom:10px;" >
																	${loggedInUserNickname === boardLists.nickname ? `
																	<button class="btn btn-light" type="button" data-bs-toggle="dropdown" aria-expanded="false">
																		•••
																	</button>
																	` : ''}
																	<ul class="dropdown-menu dropdown-menu-dark">
																		<li><a class="dropdown-item active" id="boatd-search-update-${boardLists.boardid}">수정</a></li>
																		<li><a class="dropdown-item" id="boatd-search-delete-${boardLists.boardid}">삭제</a>
																		</li>
																	</ul>
																	
																</div>
																
															</div>
															
															<div class="row">
																<div class="input-group mb-3 ">
																	<input type="text" class="form-control shadow" id="ripple-search-input${boardLists.boardid}" ;
																		aria-describedby="ripple-search-create${boardLists.boardid}">
																	<button class="btn btn-outline-info shadow" type="button"
																		id="ripple-search-create${boardLists.boardid}">댓글</button>
																</div>
															</div>
															
															<div class="row" id="search-ripple-${boardLists.boardid}">
															</div>
															<div class="row" id="search-ripple-page-${boardLists.boardid}">
															</div>
														</div>
														
													</div>
												</div>
											</div>
											
										</div>
										
									</div>
								</div>
							`);
							licks();

							$(`#boatd-search-update-${boardLists.boardid}`).on('click', function () {
								const updatesearch = $(`#update-search-item-${boardLists.content}`);
								updatesearch.empty();
								updatesearch.append(`
								<div class="input-group mb-3" >
									<input type="text" value="${boardLists.content}" class="form-control shadow" id="board-search-input${boardLists.boardid}"; aria-describedby="board-search-create${boardLists.boardid}">
									<button class="btn btn-outline-info shadow" type="button" id="board-search-create${boardLists.boardid}">수정</button>
								</div>
								
								`);
								$(`#board-search-create${boardLists.boardid}`).on('click', function () {
									let boardcontents = $(`#board-search-input${boardLists.boardid}`).val();
									if (boardcontents == '' || null) {
										alert("내용을 입력해주세요")
									} else {
										$.ajax({
											url: apiURL + '/update',
											type: 'POST',
											contentType: 'application/json',
											data: JSON.stringify({
												content: boardcontents,
												boardid: boardLists.boardid
											}),
											success: function (update) {

												updatesearch.empty();
												updatesearch.append(`
										      <a style="font-size: 2em;">${update}</a>
										    `);
											}
										});
									}

								});
							});
							$(`#boatd-search-delete-${boardLists.boardid}`).on('click', function () {
								if (confirm("삭제하시겠습니까?")) {
									$.ajax({
										url: apiURL + '/delete',
										type: 'DELETE',
										contentType: 'application/json',
										data: JSON.stringify({
											boardimgs: searchboardLists,
											boardid: boardLists.boardid
										}),
										success: function () {

											$(`#search-modal-${boardLists.boardid}`).modal('hide');
											window.location.href = '/board';

										}
									});

								}
							});

							function licks() {
								const lickid = $(`#search-like-${boardLists.boardid}`);
								let requestData = {
									boardid: `${boardLists.boardid}`
								};

								$.ajax({
									url: '/api/like',
									type: 'POST',
									contentType: 'application/json',
									data: JSON.stringify(requestData),
									success: function (data) {

										lickid.empty();
										const boardIdAttr = (data.countcheck === 0) ? boardLists.boardid : `${boardLists.boardid}-fill`;
										const iconClass = (data.countcheck === 0) ? 'bi bi-heart' : 'bi bi-heart-fill';
										const icon = $('<i></i>').addClass(iconClass).attr('data-boardid', boardIdAttr);
										const likenum = $('<a></a>').text(data.countBoard);
										lickid.append(icon);
										lickid.append(likenum);
									}
								});

								lickid.on('click', 'i', function () {
									const boardId = $(this).data('boardid');


									if (boardId == boardLists.boardid) {
										$.ajax({
											url: '/api/like/create',
											type: 'POST',
											contentType: 'application/json',
											data: JSON.stringify(requestData),
											success: function (data) {
												lickid.empty();
												const boardIdAttr = `${boardLists.boardid}-fill`;
												const iconClass = 'bi bi-heart-fill';

												const icon = $('<i></i>').addClass(iconClass).attr('data-boardid', boardIdAttr);
												const likenum = $('<a></a>').text(data);
												lickid.append(icon);
												lickid.append(likenum);

											}
										});

									} else {
										$.ajax({
											url: '/api/like/delete',
											type: 'POST',
											contentType: 'application/json',
											data: JSON.stringify(requestData),
											success: function (data) {
												lickid.empty();
												const boardIdAttr = boardLists.boardid;
												const iconClass = 'bi bi-heart';

												const icon = $('<i></i>').addClass(iconClass).attr('data-boardid', boardIdAttr);
												const likenum = $('<a></a>').text(data);
												lickid.append(icon);
												lickid.append(likenum);
											}
										});

									}

								});
							};

							$(`#search-${boardLists.boardid}`).on('click', function () {
								const searchRipple = $(`#search-ripple-${boardLists.boardid}`);
								const pageingsid = $(`#search-ripple-page-${boardLists.boardid}`);
								let Pagenum = 0;

								searchPageRipple();
								function searchPageRipple() {
									searchRipple.empty();
									pageingsid.empty();
									$.ajax({
										url: apiURL + `/ripple?boardid=${boardLists.boardid}&page=${Pagenum}&size=5`,
										type: 'GET',
										success: function (lists) {


											lists.content.forEach(function (rippleLists) {

												searchRipple.append(`
													<div class="container" style=" margin-bottom: 10px;" >
													<div class="card " >
														
													 <div class="card-header" style="display: flex; align-items: center;">
													    <h5 class="card-title" style="width:700px; align-items: center;""> 
													        <img src="${rippleLists.img ? rippleLists.img : defaultImage}" style="width:40px; height:40px; border-radius:50%; margin-right:10px;">${rippleLists.nickname}  •  ${rippleLists.timeDifferences}
													    </h5>
													    <div class="container text-end" >
													        ${loggedInUserNickname === rippleLists.nickname ? `
													        <button class="btn btn-light" type="button" data-bs-toggle="dropdown" aria-expanded="false">
													            •••
													        </button>` : ''}
													        <ul class="dropdown-menu dropdown-menu-dark">
													            <li><a class="dropdown-item active" id="ripple-search-update-${rippleLists.ri_id}">수정</a></li>
													            <li><a class="dropdown-item" id="ripple-search-delete-${rippleLists.ri_id}">삭제</a></li>
													        </ul>
													    </div>
													</div>
															
													  <div class="card-body">
														<div class="card-text" id="text-${rippleLists.ri_id}">${rippleLists.ri_content}</div>
													  </div>
													</div>	
													</div>													
													
													`);


												$(`#ripple-search-update-${rippleLists.ri_id}`).on('click', function () {
													const textUpdate = $(`#text-${rippleLists.ri_id}`);
													textUpdate.empty();
													textUpdate.append(`
														<div class="input-group mb-3">
															<input type="text" class="form-control" value="${rippleLists.ri_content}" id="ripple-search-input${rippleLists.ri_id}"; >
															<button class="btn btn-outline-primary" type="button" id="update-search-ricontent-${rippleLists.ri_id}">수정</button>
														</div>
													`);
													$(`#update-search-ricontent-${rippleLists.ri_id}`).on('click', function () {
														let rippletext = $(`#ripple-search-input${rippleLists.ri_id}`).val();
														if (rippletext == '' || null) {
															alert("내용을 입력해주세요");
														} else {
															fetch(apiURL + '/rippleUpdate', {
																method: 'POST',
																headers: {
																	'Content-Type': 'application/json',
																},
																body: JSON.stringify({
																	ri_content: rippletext,
																	ri_id: rippleLists.ri_id
																}),

															})

																.then(() => {

																	searchPageRipple();
																})

														}
													});
												});
												$(`#ripple-search-delete-${rippleLists.ri_id}`).on('click', function () {
													if (confirm("삭제하시겠습니까?")) {
														fetch(apiURL + '/rippledelete', {
															method: 'DELETE',
															body: JSON.stringify({
																ri_id: rippleLists.ri_id
															}),
															headers: {
																'Content-Type': 'application/json',
															},
														})
															.then(() => {

																searchPageRipple();
															})


													}
												});
											});

											if (lists.totalPages > 1) {

												const maxPagesToShow = 10;
												const totalPages = lists.totalPages;

												const startPage = Math.floor((Pagenum) / maxPagesToShow) * maxPagesToShow + 1;
												const endPage = Math.min(startPage + maxPagesToShow - 1, totalPages);

												pageingsid.append(`
													  <nav aria-label="Page navigation example">
											            <ul class="pagination justify-content-center">
											                ${startPage === 1 ? '' : `<li class="page-item"><a class="page-link" aria-label="Previous" id="ripple-${boardLists.boardid}-prev" data-page="${Pagenum - maxPagesToShow}"><span aria-hidden="true">&laquo;</span></a></li>`}
											                
											                ${Array.from({length: endPage - startPage + 1}, (_, index) => {
													const pageNumber = startPage + index;
													return `<li class="page-item"><a class="page-link" id="page-link-${boardLists.boardid}-${pageNumber}" data-page="${pageNumber}">${pageNumber}</a></li>`;
												}).join('')}
											                
											                ${endPage >= totalPages ? '' : `<li class="page-item"><a class="page-link" id="ripple-${boardLists.boardid}-next" aria-label="Next" data-page="${Pagenum + maxPagesToShow}"><span aria-hidden="true">&raquo;</span></a></li>`}
											            </ul>
											        </nav>
													`);



												Array.from({length: endPage - startPage + 1}, (_, index) => {
													const pageNumber = startPage + index;

													$(`#page-link-${boardLists.boardid}-${pageNumber}`).on('click', function () {

														$.get(apiURL + `/ripple?boardid=${boardLists.boardid}&page=${pageNumber - 1}&size=5`, function (dataList) {
															Pagenum = pageNumber - 1;

															searchPageRipple();
														});
													});

												});
												$(`#ripple-${boardLists.boardid}-prev`).on('click', function () {
													const newPage = Pagenum - maxPagesToShow < 0 ? 0 : Pagenum - maxPagesToShow;
													$.get(apiURL + `/ripple?boardid=${boardLists.boardid}&page=${newPage}&size=5`, function (dataList) {
														Pagenum = newPage;

														searchPageRipple();
													});
												});

												$(`#ripple-${boardLists.boardid}-next`).on('click', function () {
													const newPage = startPage + maxPagesToShow;
													$.get(apiURL + `/ripple?boardid=${boardLists.boardid}&page=${newPage - 1}&size=5`, function (dataList) {
														Pagenum = newPage - 1;

														searchPageRipple();
													});
												});



											};

										}
									})


								};

								$(`#ripple-search-create${boardLists.boardid}`).on('click', function () {
									const rippleinputSelector = `#ripple-search-input${boardLists.boardid}`;

									let inputval = $(rippleinputSelector).val();

									if (inputval === '' || inputval === null) {
										alert("내용을 입력해주세요")
									} else {
										$.ajax({
											url: apiURL + '/ripple',
											type: 'POST',
											contentType: 'application/json',
											data: JSON.stringify({
												ri_content: inputval,
												boardid: boardLists.boardid
											}),
											success: function () {
												searchPageRipple();
												$(rippleinputSelector).val('');
											}
										});
									}
								});


								$(`#search-modal-${boardLists.boardid}`).modal('show');
							});

						});

					}

				});
				$.ajax({
					url: '/security-login/userList?keyword=' + searchinput,
					type: 'GET',
					success: function (user) {
						console.log(user);
						userList.append(`
							<div class="container" style="margin-bottom: 10px; margin-top: 10px;">
							<h5 class="text-center" style="font-size: 20px;"><i class="bi bi-search"></i> search " ${searchinput} "</h5>		
							</div>
						`);
						user.forEach(function (list) {
							userList.append(`
							<div class="card" style="margin-top:10px;" >
						      <div class="card-body">
						        <h5 class="card-title"> <img src="${list.img ? list.img : defaultImage}" style="width:40px ; height: 40px; border-radius: 50%; margin-right: 10px; border: 1px solid #000;">	
													${list.nickname}</h5>
						        <p class="card-text">${list.text ? list.text : ""}</p>
						      </div>
						    </div>
						`);
						});


					}
				});
			}

			$('#search-input').val('');
		});





		$(`#myPage`).on('click', function () {
			let Pagenum = 0;
			mainboard.empty();
			$.get(apiURL + '/mypage', function (list) {

				mainboard.append(`
		        <div class="container " style=" background-color: white;">
		            <div class="row shadow">
		                <div class="col-6" >
							<img src="${list[0].user.img ? list[0].user.img : defaultImage}" class="img-thumbnail" 
							style="width:100px ; height: 100px; margin-right: 10px; ">
		                    <a style="font-size: 2.5em;">${list[0].user.nickname}</a>
		                </div>
		                <div class="col-2" >
						</div>
						<div class="col-2" >
						</div>
						<div class="col-2" >
						</div>	 	
		            </div>	
		            <div class="row" id="dynamicRows">
					</div>	 
		        </div>
		    `);
				let dynamicRows = $('#dynamicRows');
				list.forEach(function (item) {
					const myPageImageUrl = [item.boardimg1, item.boardimg2, item.boardimg3, item.boardimg4, item.boardimg5].filter(Boolean);

					let dynamicDiv = $(`
						
					        <div class="col-4 " id="mypage-${item.boardid}"  data-bs-target="#mypage-modal-${item.boardid}">
					            <img src="${item.boardimg1}" class="img-thumbnail" 
								style="width:300px ; height: 300px; margin-bottom: 10px;margin-top: 10px;">
					        </div>
				        
				    `);
					dynamicRows.append(dynamicDiv);

					$(`#mypage-${item.boardid}`).on('click', function () {

						contentid.append(`
				            <div class="modal " id="mypage-modal-${item.boardid}" tabindex="-1" >
				                <div class="modal-dialog modal-dialog-centered modal-xl"  >
				                    <div class="modal-content">
				                        <div class="modal-header">
				                            <h5 class="modal-title">${item.user.nickname}</h5>
				                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
				                        </div>
				                        <div class="modal-body">
				                          <div class="container-fluid">
										  	<div class="row">
				                          	 
				                          	 <div class="col-md-7 ">
												<div class="row shadow">     
													<div id="carouselMy-${item.boardid}" class="carousel slide">
													  <div class="carousel-inner">    
														${myPageImageUrl.map((imageUrl, index) => `
														<div id="img-${index}" class="carousel-item ${index === 0 ? 'active' : ''}">
														<img src="${imageUrl}"  class="d-block w-100" style="height: 600px;"  alt="Image ${index + 1}">
														</div>
														`).join('')}    
													  </div>
													  <button class="carousel-control-prev" type="button" data-bs-target="#carouselMy-${item.boardid}" data-bs-slide="prev">
													    <span class="carousel-control-prev-icon" aria-hidden="true"></span>
													  </button>
													  <button class="carousel-control-next" type="button" data-bs-target="#carouselMy-${item.boardid}" data-bs-slide="next">
													    <span class="carousel-control-next-icon" aria-hidden="true"></span>
													  </button>
													</div>	  
												</div> 
												<div class="row shadow" style=" margin-bottom: 10px;margin-top: 10px;" >  
													<div id="update-my-${item.boardid}" style="font-size: 2em;">
													</div>
													<div id="update-my-item-${item.content}">
													  <a style="font-size: 2em;">${item.content}</a>
													</div> 
												</div>	
											 </div>
      										 <div class="col-md-5 " >
												 <div class="row">  
												 	<div class="dropdown text-end" style=" margin-bottom: 10px;">
														<button class="btn btn-light " type="button" data-bs-toggle="dropdown" aria-expanded="false">
							                                •••
							                            </button>
							                            
							                            <ul class="dropdown-menu dropdown-menu-dark">
															<li><a class="dropdown-item active" id="boatd-my-update-${item.boardid}">수정</a></li>
															<li><a class="dropdown-item" id="boatd-my-delete-${item.boardid}">삭제</a></li>
							                            </ul>
							                        </div>  
							                    </div>     
												<div class="row">
													<div class="input-group mb-3">
													<input type="text" class="form-control" id="ripple-my-input${item.boardid}"; aria-describedby="ripple-my-create${item.boardid}">
													<button class="btn btn-outline-info" type="button" id="ripple-my-create${item.boardid}">댓글</button>
													</div>
												</div>
												<div class="row" id="mypage-riple-${item.boardid}">
												</div>
												<div id="mypage-riple-page-${item.boardid}">
												</div>	

											 
											 
											 </div>
				                          	
				                          	</div>
				                          </div>
				                         
				                        </div>
				                    </div>
				                </div>
				            </div>
				        `);
						licks();
						function licks() {
							const lickid = $(`#update-my-${item.boardid}`);
							let requestData = {
								boardid: `${item.boardid}`
							};

							$.ajax({
								url: '/api/like',
								type: 'POST',
								contentType: 'application/json',
								data: JSON.stringify(requestData),
								success: function (data) {

									lickid.empty();
									const boardIdAttr = (data.countcheck === 0) ? item.boardid : `${item.boardid}-fill`;
									const iconClass = (data.countcheck === 0) ? 'bi bi-heart' : 'bi bi-heart-fill';
									const icon = $('<i></i>').addClass(iconClass).attr('data-boardid', boardIdAttr);
									const likenum = $('<a></a>').text(data.countBoard);
									lickid.append(icon);
									lickid.append(likenum);
								}
							});

							lickid.on('click', 'i', function () {
								const boardId = $(this).data('boardid');


								if (boardId == item.boardid) {
									$.ajax({
										url: '/api/like/create',
										type: 'POST',
										contentType: 'application/json',
										data: JSON.stringify(requestData),
										success: function (data) {
											lickid.empty();
											const boardIdAttr = `${item.boardid}-fill`;
											const iconClass = 'bi bi-heart-fill';

											const icon = $('<i></i>').addClass(iconClass).attr('data-boardid', boardIdAttr);
											const likenum = $('<a></a>').text(data);
											lickid.append(icon);
											lickid.append(likenum);

										}
									});

								} else {
									$.ajax({
										url: '/api/like/delete',
										type: 'POST',
										contentType: 'application/json',
										data: JSON.stringify(requestData),
										success: function (data) {
											lickid.empty();
											const boardIdAttr = item.boardid;
											const iconClass = 'bi bi-heart';

											const icon = $('<i></i>').addClass(iconClass).attr('data-boardid', boardIdAttr);
											const likenum = $('<a></a>').text(data);
											lickid.append(icon);
											lickid.append(likenum);
										}
									});

								}

							});
						};

						const mypageriple = $(`#mypage-riple-${item.boardid}`);
						$(`#boatd-my-update-${item.boardid}`).on('click', function () {
							const contentmy = $(`#update-my-item-${item.content}`);
							contentmy.empty();
							contentmy.append(`
								<div class="input-group mb-3" >
									<input type="text" value="${item.content}" class="form-control" id="board-my-input${item.boardid}"; aria-describedby="board-my-create${item.boardid}">
									<button class="btn btn-outline-info" type="button" id="board-my-create${item.boardid}">수정</button>
								</div>
							`);
							$(`#board-my-create${item.boardid}`).on('click', function () {
								let boardcontent = $(`#board-my-input${item.boardid}`).val();
								if (boardcontent == '' || null) {
									alert("내용을 입력해주세요")
								} else {
									$.ajax({
										url: apiURL + '/update',
										type: 'POST',
										contentType: 'application/json',
										data: JSON.stringify({
											content: boardcontent,
											boardid: item.boardid
										}),
										success: function (update) {

											contentmy.empty();
											contentmy.append(`
										      <a style="font-size: 2em;">${update}</a>
										    `);
										}
									});
								}
							});
						});


						$(`#boatd-my-delete-${item.boardid}`).on('click', function () {
							if (confirm("삭제하시겠습니까?")) {
								$.ajax({
									url: apiURL + '/delete',
									type: 'DELETE',
									contentType: 'application/json',
									data: JSON.stringify({
										boardimgs: myPageImageUrl,
										boardid: item.boardid
									}),
									success: function () {

										$(`#mypage-modal-${item.boardid}`).modal('hide');

										updateBoardList();
									}
								});

							}

						});






						$(`#ripple-my-create${item.boardid}`).on('click', function () {
							const rippleinputSelector = `#ripple-my-input${item.boardid}`;

							let inputval = $(rippleinputSelector).val();
							if (inputval === '' || inputval === null) {
								alert("내용을 입력해주세요")
							} else {
								fetch(apiURL + '/ripple', {
									method: 'POST',
									headers: {
										'Content-Type': 'application/json',
									},
									body: JSON.stringify({
										ri_content: inputval,
										boardid: item.boardid
									}),
								})
									.then(() => {
										mypageriple.empty();
										myPageRipple();
									})

							}
						});


						mypageriple.empty();
						myPageRipple();

						function myPageRipple() {
							$.get(apiURL + `/ripple?boardid=${item.boardid}&page=${Pagenum}&size=5`, function (dataList) {


								dataList.content.forEach(data => {

									mypageriple.append(`
										
							            <div class="card">
											
							                <div class="card-body d-flex flex-row justify-content-between">
							                    <h6 class="card-title"> 
												 <img src="${data.img ? data.img : defaultImage}" style="width:40px ; height: 40px; border-radius: 50%; margin-right: 10px; border: 1px solid #000;">	
													${data.nickname}
													   • ${data.timeDifferences}
												</h6>
							                    <div class="ml-auto">
							                        <div class="dropdown">
														<button class="btn btn-light" type="button" data-bs-toggle="dropdown" aria-expanded="false">
							                                •••
							                            </button>
							                            
							                            <ul class="dropdown-menu dropdown-menu-dark">
															${loggedInUserNickname === data.nickname ? `
							                                <li><a class="dropdown-item active" id="ripple-update-${data.ri_id}">수정</a></li>
															` : ''}							                               
															<li><a class="dropdown-item" id="ripple-delete-${data.ri_id}">삭제</a></li>
							                            </ul>
							                            
							                        </div>
							                    </div>
							                </div>
							                
							                <div  class="container" id="data-my-${data.ri_id}">
							                	<h5 class="card-text " style="margin-bottom:20px;" >${data.ri_content}</h5>
							                </div>
							                
							               
							            </div>
							           
							        `);
									$(`#ripple-update-${data.ri_id}`).on('click', function () {
										const ricontents = $(`#data-my-${data.ri_id}`);
										ricontents.empty();
										ricontents.append(`
											<div class="input-group mb-3">
												<input type="text" class="form-control" value="${data.ri_content}" id="ripple-my-input${data.ri_id}"; aria-describedby="ripple-my-create${item.boardid}">
												<button class="btn btn-outline-primary" type="button" id="update-my-ricontent-${data.ri_id}">수정</button>
											</div>
										`);
										$(`#update-my-ricontent-${data.ri_id}`).on('click', function () {
											const ripplemyinput = $(`#ripple-my-input${data.ri_id}`).val();

											if (ripplemyinput == '' || null) {
												alert("내용을 입력해주세요");
											} else {
												fetch(apiURL + '/rippleUpdate', {
													method: 'POST',
													headers: {
														'Content-Type': 'application/json',

													},
													body: JSON.stringify({
														ri_content: ripplemyinput,
														ri_id: data.ri_id
													}),

												})

													.then(() => {
														mypageriple.empty();
														myPageRipple();

													})

											}
										});
									})




									$(`#ripple-delete-${data.ri_id}`).on('click', function () {
										if (confirm("삭제하시겠습니까?")) {
											fetch(apiURL + '/rippledelete', {
												method: 'DELETE',
												body: JSON.stringify({
													ri_id: data.ri_id
												}),
												headers: {
													'Content-Type': 'application/json',
												},
											})
												.then(() => {
													mypageriple.empty();
													myPageRipple();
												})


										}

									});
								});


								if (dataList.totalPages > 1) {
									const mypageing = $(`#mypage-riple-page-${item.boardid}`);
									const maxPagesToShow = 10;
									let totalPages = dataList.totalPages;


									let startPage = Math.floor((Pagenum) / maxPagesToShow) * maxPagesToShow + 1;
									let endPage = Math.min(startPage + maxPagesToShow - 1, totalPages);

									mypageing.append(`
									  <nav aria-label="Page navigation example " style="margin-top: 10px; ">
							            <ul class="pagination justify-content-center">
							                ${startPage === 1 ? '' : `<li class="page-item"><a class="page-link" aria-label="Previous" id="ripple-${item.boardid}-prev" data-page="${Pagenum - maxPagesToShow}"><span aria-hidden="true">&laquo;</span></a></li>`}
							                
							                ${Array.from({length: endPage - startPage + 1}, (_, index) => {
										const pageNumber = startPage + index;
										return `<li class="page-item"><a class="page-link" id="page-link-${item.boardid}-${pageNumber}" data-page="${pageNumber}">${pageNumber}</a></li>`;
									}).join('')}
							                
							                ${endPage >= totalPages ? '' : `<li class="page-item"><a class="page-link" id="ripple-${item.boardid}-next" aria-label="Next" data-page="${Pagenum + maxPagesToShow}"><span aria-hidden="true">&raquo;</span></a></li>`}
							            </ul>
							         </nav>
									`);



									Array.from({length: endPage - startPage + 1}, (_, index) => {
										const pageNumber = startPage + index;

										$(`#page-link-${item.boardid}-${pageNumber}`).on('click', function () {

											$.get(apiURL + `/ripple?boardid=${item.boardid}&page=${pageNumber - 1}&size=5`, function (dataList) {
												Pagenum = pageNumber - 1;
												mypageriple.empty();
												mypageing.empty();
												myPageRipple();
											});
										});

									});
									$(`#ripple-${item.boardid}-prev`).on('click', function () {
										const newPage = Pagenum - maxPagesToShow < 0 ? 0 : Pagenum - maxPagesToShow;
										$.get(apiURL + `/ripple?boardid=${item.boardid}&page=${newPage}&size=5`, function (dataList) {
											Pagenum = newPage;
											mypageriple.empty();
											mypageing.empty();
											myPageRipple();
										});
									});

									$(`#ripple-${item.boardid}-next`).on('click', function () {
										const newPage = startPage + maxPagesToShow;
										$.get(apiURL + `/ripple?boardid=${item.boardid}&page=${newPage - 1}&size=5`, function (dataList) {
											Pagenum = newPage - 1;

											mypageriple.empty();
											mypageing.empty();
											myPageRipple();
										});
									});



								};



							});
						};


						// 모달 표시
						$(`#mypage-modal-${item.boardid}`).modal('show');

					});

				});
			});
		});

		$(`#userdelete`).on('click', function () {
			const confirmation = confirm('회원탈퇴 계속하시겠습니까?');
			if (confirmation) {
				$.ajax({
					url: apiURL + "/deleteAlls",
					type: "POST",
					processData: false,
					contentType: false,
					success: function () {

						$.ajax({
							url: "/security-login/deleteUser",
							type: "GET",
							processData: false,
							contentType: false,
							success: function (redirectUrl) {
								window.location.href = redirectUrl;
							}
						});
					}
				});
			}
		});

		$(`#userupdate`).on('click', function () {
			mainboard.empty();
			contentid.empty();
			$.get('/security-login/info', function (user) {

				contentid.append(`
				<div class="container">
					
					<div class=" card mb-3"  style="max-width: 1000px;">
						
						  <div class="row g-0">
							  
							<div class="col-md-4 text-bg-light" id="ImageupdateInput"> 
								
									<img id="previewImageupdate" src="${user.img ? user.img : defaultImage}" class="img-fluid rounded-start" style="width:100% ; height: 87.9%;" >
	 								<input id="originalImg" type="hidden" value="${user.img}" >
	 							<div class="card-footer"  >
							  		<input class="form-control" type="file" id="imagefileupdate" >
								</div>
							</div>
							
							<div class="col-md-8"> 
								<div class="card-body">
									
							        <label class="col-form-label">닉네임</label>
							        <div class="form-floating">
								        <input class="form-control " id="nicknameval" type="text" value="${user.nickname}"  >
								        <label for="nicknameval" >
										   <span id="nicknamevals">
											</span>		
										</label>
							        </div>
							       
							        <label class="col-form-label" >자기소개</label>
							        <input class="form-control" id="textval" type="text" value="${user.text}" " >
							        
							        <label class="col-form-label" >비밀번호</label>
							        <div class="form-floating">
							        	<input class="form-control" id="passwordval" type="password" >
							       	    <label for="passwordval" >
											   <span  id="passwordvals">
											</span>	
										   </label>
							        </div>
							       	
							        <label class="col-form-label" >비밀번호 확인</label>
							        <div class="form-floating">
							        	<input class="form-control" id="passwordcheckval" type="password" >
							    	    <label for="passwordcheckval">
											<span  id="passwordcheckvals">
											</span>	
										</label>
							        </div>
							    
							    </div>
							   
							   	<div class="card-footer text-end">
						  			 <button class="btn btn-outline-info" type="button" id="updatebtn">수정</button>
						  		</div>
						  	</div>	
						  
						</div>
					</div>
					
				</div>
					
				`);
				const imagefileupdate = $('#imagefileupdate');
				const previewImageupdate = $('#previewImageupdate');
				imagefileupdate.on("change", function () {
					// 이미지를 선택하면 미리보기 이미지를 설정합니다.
					const file = imagefileupdate[0].files[0];
					const imageUrl = URL.createObjectURL(file);

					previewImageupdate.attr('src', imageUrl);

					const formData = new FormData();
					formData.append('file', file);

					$.ajax({
						url: "/security-login/upload",
						type: "POST",
						data: formData,
						processData: false,
						contentType: false,
						success: function (uniqueFileName) {

							const imgField = $('<input>', {type: "hidden", id: "imgval", value: uniqueFileName});

							$('#ImageupdateInput').append(imgField);
						}
					});
				});





				$(`#updatebtn`).on('click', function () {
					const nicknameval = $('#nicknameval').val();
					const textval = $('#textval').val();
					const passwordval = $('#passwordval').val();
					const passwordcheckval = $('#passwordcheckval').val();
					const imgval = $('#imgval').val();
					const originalImgs = $('#originalImg').val();

					fetch('/security-login/userUpdate', {
						method: 'POST',
						headers: {
							'Content-Type': 'application/json',
						},
						body: JSON.stringify({
							nickname: nicknameval,
							text: textval,
							password: passwordval,
							passwordCheck: passwordcheckval,
							img: imgval,
							originalImg: originalImgs
						}),

					})
						.then(response => {

							if (!response.ok) {
								return response.json().then(data => {

									if (data.nickname) {

										document.getElementById('nicknameval').classList.add('is-invalid');
										document.getElementById('nicknamevals').textContent = data.nickname;
									} else {
										document.getElementById('nicknamevals').textContent = "";
									}

									if (data.password) {
										document.getElementById('passwordval').classList.add('is-invalid');
										document.getElementById('passwordvals').textContent = data.password;
									} else {
										document.getElementById('passwordvals').textContent = "";
									}

									if (data.passwordCheck) {
										document.getElementById('passwordcheckval').classList.add('is-invalid');
										document.getElementById('passwordcheckvals').textContent = data.passwordCheck;
									} else {
										document.getElementById('passwordcheckvals').textContent = "";
									}



								});
							}
							else if (response.ok) {
								window.location.href = '/security-login/logout';

							}

						})




				});

			});
		});




		// 페이지가 로드될 때 게시글 목록을 업데이트
		function updateBoardList() {
			$.get(apiURL, function (data) {
				mainboard.empty(); // 게시판 목록 초기화

				// 각 게시글에 대한 정보를 목록에 추가
				data.forEach(function (item) {
					const defaultImage = '/uploads/final/main.jpg';
					const itemString = JSON.stringify(item);
					const imageUrls = [item.boardimg1, item.boardimg2, item.boardimg3, item.boardimg4, item.boardimg5].filter(Boolean);
					let currentPage = 0;
					// 각 수정 버튼에 고유한 ID 할당
					const boardUpdateBtnId = `boardupdate-${item.boardid}`;
					const modalId = `exampleModal3-${item.boardid}`;


					mainboard.append(`
		                <div class="card" id="card">
		                    <div class="card-header " style="display: flex; justify-content: space-between; align-items: center;">
		                        <div style="display: flex; align-items: center;">
		                            <img src="${item.img ? item.img : defaultImage}" style="width:40px ; height: 40px; border-radius: 50%; margin-right: 10px; border: 1px solid #000;">
		                            <h5 style="margin: 0;">${item.nickname} • ${item.timeDifference}</h5>
		                        </div>
		                        ${loggedInUserNickname === item.nickname ? `
		                            <button type="button" style="float: right;" class="btn btn-light" data-bs-toggle="modal" data-bs-target="#${modalId}">
		                                •••
		                            </button>` : ''}
		                        <div class="modal fade" id="${modalId}" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
		                            <div class="modal-dialog modal-dialog-centered ">
		                                <div class="modal-content">
		                                    <ul class="list-group ">
		                                        <!-- 각 수정 버튼에 고유한 ID 할당 -->
		                                       <li id="${boardUpdateBtnId}" data-bs-toggle="modal" data-bs-target="#update-${item.boardid}" data-bs-info='${itemString}'class="list-group-item list-group-item-action text-center fw-semibold ">수정하기</li>
		
		                                        <li id="delete-${boardUpdateBtnId}"  class="list-group-item list-group-item-action text-center fw-semibold ">삭제하기
		                                        </li>
		                                        <li data-bs-dismiss="modal" class="list-group-item list-group-item-action text-center fw-semibold ">
		                                            취소</li>
		                                    </ul>
		                                </div>
		                            </div>
		                        </div>
		                    <div class="modal fade" id="update-${item.boardid}" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
				            	<div class="modal-dialog modal-dialog-centered ">
									
		      							<div class="modal-content">
											  
											<div class="modal-header">
												<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
											</div>
											
											<div class="modal-body">
												 
												<div id="board-imgs-${item.boardid}" class="carousel slide">
													<div class="carousel-inner">
														${imageUrls.map((imageUrl, index) => `
						                                    <div id="img-${index}" class="carousel-item ${index === 0 ? 'active' : ''}">
																
						                                        <img src="${imageUrl}"  class="d-block w-100" style="height: 400px;"  alt="Image ${index + 1}">
						                                    </div>
						                                    
						                                `).join('')}
						                            </div>
						                            <button class="carousel-control-prev" type="button" data-bs-target="#board-imgs-${item.boardid}" data-bs-slide="prev">
						                                <span class="carousel-control-prev-icon" aria-hidden="true"></span>
						                            </button>
						                            <button class="carousel-control-next" type="button" data-bs-target="#board-imgs-${item.boardid}" data-bs-slide="next">
						                                <span class="carousel-control-next-icon" aria-hidden="true"></span>
						                            </button>
						                        </div>
						                        <br/>
						                        <textarea class="form-control" id="contentupdate-${item.boardid}" required>${item.content}</textarea>
											</div>
				                        	<div class="modal-footer">
												<button type="button" id="updates-${item.boardid}" class="btn btn-primary">수정하기</button>
											</div>
				                        </div>
				                    </div>
				                </div>
		                    </div>
		                    <div id="cardbody" class="card-body" >
		                        <div id="board-img-${item.boardid}" class="carousel slide">
		                            <div class="carousel-inner">
		                                ${imageUrls.map((imageUrl, index) => `
		                                    <div class="carousel-item ${index === 0 ? 'active' : ''}">
		                                        <img src="${imageUrl}" class="d-block w-100" style="height: 400px;"  alt="Image ${index + 1}">
		                                    </div>
		                                `).join('')}
		                            </div>
		                            <button class="carousel-control-prev" type="button" data-bs-target="#board-img-${item.boardid}" data-bs-slide="prev">
		                                <span class="carousel-control-prev-icon" aria-hidden="true"></span>
		                            </button>
		                            <button class="carousel-control-next" type="button" data-bs-target="#board-img-${item.boardid}" data-bs-slide="next">
		                                <span class="carousel-control-next-icon" aria-hidden="true"></span>
		                            </button>
		                        </div>
		                    </div>
		                   	<div class="card-footer text-body-secondary">
								 <div style="font-size: 1.5em;">   
									 <div id="like-${item.boardid}" >
										
									 </div>
								 	 ${item.content}
								 </div> 
								
							</div>	 
		                    <div class="card-footer text-body-secondary">
								<div class="input-group mb-3">
								  <input type="text" class="form-control" id="ripple-input${item.boardid}"; aria-describedby="ripple-create${item.boardid}">
								  <button class="btn btn-outline-info" type="button" id="ripple-create${item.boardid}">댓글</button>
								</div>
								<div id="ripples-${item.boardid}">
							
							
							</div>
							<div class="card-footer" id="ripple-${item.boardid}">
							
							
							</div>
								
								<a id="ripple-plus-${item.boardid}" class="card-link">더보기</a>
		                    </div>
		                </div>
		                <br/>
		            `);



					licks()
					ripplelists()

					function licks() {
						const lickid = $(`#like-${item.boardid}`);
						let requestData = {
							boardid: `${item.boardid}`
						};

						$.ajax({
							url: '/api/like',
							type: 'POST',
							contentType: 'application/json',
							data: JSON.stringify(requestData),
							success: function (data) {

								lickid.empty();
								const boardIdAttr = (data.countcheck === 0) ? item.boardid : `${item.boardid}-fill`;
								const iconClass = (data.countcheck === 0) ? 'bi bi-heart' : 'bi bi-heart-fill';
								const icon = $('<i></i>').addClass(iconClass).attr('data-boardid', boardIdAttr);
								const likenum = $('<a></a>').text(data.countBoard);
								lickid.append(icon);
								lickid.append(likenum);
							}
						});

						lickid.on('click', 'i', function () {
							const boardId = $(this).data('boardid');


							if (boardId == item.boardid) {
								$.ajax({
									url: '/api/like/create',
									type: 'POST',
									contentType: 'application/json',
									data: JSON.stringify(requestData),
									success: function (data) {
										lickid.empty();
										const boardIdAttr = `${item.boardid}-fill`;
										const iconClass = 'bi bi-heart-fill';

										const icon = $('<i></i>').addClass(iconClass).attr('data-boardid', boardIdAttr);
										const likenum = $('<a></a>').text(data);
										lickid.append(icon);
										lickid.append(likenum);

									}
								});

							} else {
								$.ajax({
									url: '/api/like/delete',
									type: 'POST',
									contentType: 'application/json',
									data: JSON.stringify(requestData),
									success: function (data) {
										lickid.empty();
										const boardIdAttr = item.boardid;
										const iconClass = 'bi bi-heart';

										const icon = $('<i></i>').addClass(iconClass).attr('data-boardid', boardIdAttr);
										const likenum = $('<a></a>').text(data);
										lickid.append(icon);
										lickid.append(likenum);
									}
								});

							}

						});
					};


					$(`#ripple-create${item.boardid}`).on('click', function () {

						const rippleinputSelector = `#ripple-input${item.boardid}`;
						let inputval = $(rippleinputSelector).val();
						if (inputval === '' || inputval === null) {
							alert("내용을 입력해주세요")
						} else {
							fetch(apiURL + '/ripple', {
								method: 'POST',
								headers: {
									'Content-Type': 'application/json',
								},
								body: JSON.stringify({
									ri_content: inputval,
									boardid: item.boardid

								}),

							})

								.then(() => {


									updateBoardList();
								})

						}
					});
					function ripplelists() {
						$.get(apiURL + `/ripple?boardid=${item.boardid}&page=${currentPage}&size=10`, function (dataList) {
							const rippleid = $(`#ripple-${item.boardid}`);
							const ripple = $(`#ripples-${item.boardid}`);


							ripple.empty();

							if (dataList.content.length > 0) {
								const data = dataList.content[0]; // 첫 번째 데이터만 사용

								ripple.append(`
								
				                <div class="card">
				                    <div class="card-body d-flex flex-row justify-content-between">
				                        <h6 class="card-title">
				                            <img src="${data.img ? data.img : defaultImage}" style="width:40px ; height: 40px; border-radius: 50%; margin-right: 10px; border: 1px solid #000;">
				                            ${data.nickname}
				                            • ${data.timeDifferences}
				                        </h6>
					                        <div class="ml-auto">
					                            <div class="dropdown">
					                                ${loggedInUserNickname === data.nickname ? `
					                                    <button class="btn btn-light" type="button" data-bs-toggle="dropdown" aria-expanded="false">
					                                        •••
					                                    </button>` : ''}
					
					                                <ul class="dropdown-menu dropdown-menu-dark">
					                                    <li><a class="dropdown-item active" id="ripple-update-${data.ri_id}" data-bs-toggle="modal" data-bs-target="#ripple-modals-${data.ri_id}" >수정</a></li>
					                                    <li><a class="dropdown-item" id="ripple-deletes-${data.ri_id}">삭제</a></li>
					                                </ul>
					                            </div>
					                        </div>
				                    </div>
					                <div class="container">
					                	<h5 class="card-text" style="margin-bottom:20px;" >${data.ri_content}</h5>
					                </div>
					             </div>
					             <div class="modal" id="ripple-modals-${data.ri_id}" tabindex="-1">
									<div class="modal-dialog">
										<div class="modal-content">
											<div class="modal-header">
												<h5 class="card-title"> 
												<img src="${data.img ? data.img : defaultImage}" style="width:40px ; height: 40px; border-radius: 50%; margin-right: 10px; border: 1px solid #000;">	
													${data.nickname} • ${data.timeDifferences}
												</h5>
												<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
											</div>
											<div class="modal-body">
												<textarea class="form-control" id="ripple-ricontents-${data.ri_id}" required>${data.ri_content}</textarea>
											</div>
											<div class="modal-footer">
												<button type="button" class="btn btn-primary" id="update-ricontents-${data.ri_id}">저장</button>
												<button type="button" class="btn btn-secondary" data-bs-dismiss="modal">취소</button>
											</div>
										</div>
									</div>
								</div>
				            `);


								$(`#update-ricontents-${data.ri_id}`).on('click', function () {
									const rippletextarea = $(`#ripple-ricontents-${data.ri_id}`).val();
									if (rippletextarea == '' || null) {
										alert("내용을 입력해주세요");
									} else {
										fetch(apiURL + '/rippleUpdate', {
											method: 'POST',
											headers: {
												'Content-Type': 'application/json',
												// 여기에 필요한 다른 헤더들을 추가할 수 있습니다.
											},
											body: JSON.stringify({
												ri_content: rippletextarea,
												ri_id: data.ri_id
											}), // yourData에는 PATCH 요청으로 보낼 데이터가 들어갑니다.

										})

											.then(() => {

												$(`#ripple-modals-${data.ri_id}`).modal('hide');
												ripple.empty();
												ripplelists();
											})

									}
								});
								$(`#ripple-deletes-${data.ri_id}`).on('click', function () {
									if (confirm("삭제하시겠습니까?")) {
										fetch(apiURL + '/rippledelete', {
											method: 'DELETE',
											body: JSON.stringify({
												ri_id: data.ri_id
											}),
											headers: {
												'Content-Type': 'application/json',
											},
										})
											.then(() => {
												ripple.empty();
												ripplelists();
											})


									}

								});





							};


							$(`#ripple-plus-${item.boardid}`).on('click', function () {
								currentPage = 0;
								rippleid.empty();
								ripplelist();
							});





							function ripplelist() {
								$.get(apiURL + `/ripple?boardid=${item.boardid}&page=${currentPage}&size=10`, function (dataList) {


									dataList.content.forEach(data => {

										rippleid.append(`
								
							            <div class="card">
							                <div class="card-body d-flex flex-row justify-content-between">
							                    <h6 class="card-title"> 
												 <img src="${data.img ? data.img : defaultImage}" style="width:40px ; height: 40px; border-radius: 50%; margin-right: 10px; border: 1px solid #000;">	
													${data.nickname}
													   • ${data.timeDifferences}
												</h6>
							                    <div class="ml-auto">
							                        <div class="dropdown">
														${loggedInUserNickname === data.nickname ? `
				                           				<button class="btn btn-light" type="button" data-bs-toggle="dropdown" aria-expanded="false">
							                                •••
							                            </button>` : ''}
							                            
							                            <ul class="dropdown-menu dropdown-menu-dark">
							                                <li><a class="dropdown-item active" id="ripple-update-${data.ri_id}" data-bs-toggle="modal" data-bs-target="#ripple-modal-${data.ri_id}" >수정</a></li>
							                                <li><a class="dropdown-item" id="ripple-delete-${data.ri_id}">삭제</a></li>
							                            </ul>
							                        </div>
							                    </div>
							                </div>
							                <div  class="container">
							                	<h5 class="card-text " style="margin-bottom:20px;" >${data.ri_content}</h5>
							                </div>
							                
							                <div class="modal" id="ripple-modal-${data.ri_id}" tabindex="-1">
												<div class="modal-dialog">
													<div class="modal-content">
														<div class="modal-header">
															<h5 class="card-title"> 
															 <img src="${data.img ? data.img : defaultImage}" style="width:40px ; height: 40px; border-radius: 50%; margin-right: 10px; border: 1px solid #000;">	
																${data.nickname}
																   • ${data.timeDifferences}
															</h5>
															<button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
														</div>
														<div class="modal-body">
															 <textarea class="form-control" id="ripple-ricontent-${data.ri_id}" required>${data.ri_content}</textarea>
														</div>
														<div class="modal-footer">
															<button type="button" class="btn btn-primary" id="update-ricontent-${data.ri_id}">저장</button>
															<button type="button" class="btn btn-secondary" data-bs-dismiss="modal">취소</button>
														</div>
													</div>
												</div>
											</div>
							                
							                
							                
							                
							                
							            </div>
							        `);
										$(`#update-ricontent-${data.ri_id}`).on('click', function () {
											const rippletextarea = $(`#ripple-ricontent-${data.ri_id}`).val();
											if (rippletextarea == '' || null) {
												alert("내용을 입력해주세요");
											} else {
												fetch(apiURL + '/rippleUpdate', {
													method: 'POST',
													headers: {
														'Content-Type': 'application/json',
														// 여기에 필요한 다른 헤더들을 추가할 수 있습니다.
													},
													body: JSON.stringify({
														ri_content: rippletextarea,
														ri_id: data.ri_id
													}), // yourData에는 PATCH 요청으로 보낼 데이터가 들어갑니다.

												})

													.then(() => {

														$(`#ripple-modal-${data.ri_id}`).modal('hide');
														rippleid.empty();
														ripplelist();
													})

											}






										});
										$(`#ripple-delete-${data.ri_id}`).on('click', function () {
											if (confirm("삭제하시겠습니까?")) {
												fetch(apiURL + '/rippledelete', {
													method: 'DELETE',
													body: JSON.stringify({
														ri_id: data.ri_id
													}),
													headers: {
														'Content-Type': 'application/json',
													},
												})
													.then(() => {
														rippleid.empty();
														ripplelist();
													})


											}

										});
									});

									if (dataList.totalPages > 1) {
										const maxPagesToShow = 10;
										const totalPages = dataList.totalPages;

										const startPage = Math.floor((currentPage) / maxPagesToShow) * maxPagesToShow + 1;
										const endPage = Math.min(startPage + maxPagesToShow - 1, totalPages);

										rippleid.append(`
									  <nav aria-label="Page navigation example">
							            <ul class="pagination">
							                ${startPage === 1 ? '' : `<li class="page-item"><a class="page-link" aria-label="Previous" id="ripple-${item.boardid}-prev" data-page="${currentPage - maxPagesToShow}"><span aria-hidden="true">&laquo;</span></a></li>`}
							                
							                ${Array.from({length: endPage - startPage + 1}, (_, index) => {
											const pageNumber = startPage + index;
											return `<li class="page-item"><a class="page-link" id="page-link-${item.boardid}-${pageNumber}" data-page="${pageNumber}">${pageNumber}</a></li>`;
										}).join('')}
							                
							                ${endPage >= totalPages ? '' : `<li class="page-item"><a class="page-link" id="ripple-${item.boardid}-next" aria-label="Next" data-page="${startPage + maxPagesToShow}"><span aria-hidden="true">&raquo;</span></a></li>`}
							            </ul>
							        </nav>
									`);



										Array.from({length: endPage - startPage + 1}, (_, index) => {
											const pageNumber = startPage + index;

											$(`#page-link-${item.boardid}-${pageNumber}`).on('click', function () {

												$.get(apiURL + `/ripple?boardid=${item.boardid}&page=${pageNumber - 1}&size=10`, function (dataList) {
													currentPage = pageNumber - 1;
													rippleid.empty();
													ripplelist();
												});
											});

										});
										$(`#ripple-${item.boardid}-prev`).on('click', function () {
											const newPage = currentPage - maxPagesToShow < 0 ? 0 : currentPage - maxPagesToShow;
											$.get(apiURL + `/ripple?boardid=${item.boardid}&page=${newPage}&size=10`, function (dataList) {
												currentPage = newPage;
												rippleid.empty();
												ripplelist();
											});
										});

										$(`#ripple-${item.boardid}-next`).on('click', function () {
											const newPage = startPage + maxPagesToShow;
											$.get(apiURL + `/ripple?boardid=${item.boardid}&page=${newPage - 1}&size=10`, function (dataList) {
												currentPage = newPage - 1;

												rippleid.empty();
												ripplelist();
											});
										});



									};



								});


							};

						});

					};
					$(`#updates-${item.boardid}`).on('click', function () {
						let boardcontent = $(`#contentupdate-${item.boardid}`).val();
						if (boardcontent == '' || null) {
							alert("내용을 입력해주세요")
						} else {
							fetch(apiURL + '/update', {
								method: 'POST',
								headers: {
									'Content-Type': 'application/json',
									// 여기에 필요한 다른 헤더들을 추가할 수 있습니다.
								},
								body: JSON.stringify({
									content: boardcontent,
									boardid: item.boardid
								}), // yourData에는 PATCH 요청으로 보낼 데이터가 들어갑니다.

							})

								.then(() => {

									$(`#update-${item.boardid}`).modal('hide');
									updateBoardList();
								})

						}


					});
					$(`#delete-${boardUpdateBtnId}`).on('click', function () {
						if (confirm("삭제하시겠습니까?")) {
							fetch(apiURL + '/delete', {
								method: 'DELETE',
								body: JSON.stringify({
									boardimgs: imageUrls,
									boardid: item.boardid
								}),
								headers: {
									'Content-Type': 'application/json',
								},
							})
								.then(() => updateBoardList())
								.catch(error => console.error('Error during delete request:', error))
								.finally(() => $(`#${modalId}`).modal('hide'));
						} else {
							$(`#${modalId}`).modal('hide');
						}

					});

				});
			});
		};

		// 글 목록 업데이트 함수 호출 (페이지 로드 시)
		updateBoardList();

		// 글 작성 폼 처리
		$('#createButton').on('click', function () {
			let boardsimg = $('#boardimg1');
			if (boardsimg.val() === '') {
				alert("이미지를 업로드 해주세요")
				return;
			}

			var boardImages = [];
			for (let i = 1; i <= imageInput[0].files.length; i++) {
				const imagePath = $('#boardimg' + i).val();
				if (imagePath !== null && imagePath !== '') {
					boardImages.push(imagePath);
				} else {
					// 이미지가 없으면 루프 종료
					break;
				}
			}



			$.ajax({
				url: apiURL,
				method: 'POST',
				contentType: 'application/json',
				data: JSON.stringify({
					boardimgs: boardImages,
					content: $('#content').val()
				})
			})
				.done(function (response) {
					createModal.modal('hide');
					window.location.href = '/board';
				});


		});




		imageInput.on("change", function () {
			var formData = new FormData();
			const carouselInner = $('#carousel-inner');
			let a = 0;
			for (let i = 0; i < imageInput[0].files.length; i++) {
				let file = imageInput[0].files[i];
				formData.append('files', file);
				a = i + 1;
				if (i >= 1) {
					carouselInner.append(
						`<div class="carousel-item">` +
						`<img id="imagePreview${a}" class="d-block w-100" style="height: 300px;" src="">` +
						`<input type="hidden" id="boardimg${a}" name="boardimg${a}" value="">` +
						`</div>`
					);

				} else if (i == 0) {
					let imgdiv = document.getElementById('imgdiv');
					imgdiv.removeAttribute("hidden");
				}

				let imagePreviewtem = document.getElementById('imagePreview' + a);
				imagePreviewtem.src = URL.createObjectURL(file);


			}

			// 서버로 이미지 업로드
			$.ajax({
				url: apiURL + '/boardimg',
				method: 'POST',
				processData: false,
				contentType: false,
				data: formData,
				success: function (uniqueFileNames) {
					for (let i = 0; i < uniqueFileNames.length; i++) {
						let boardsimg = $('#boardimg' + (i + 1));
						boardsimg.val(uniqueFileNames[i]);
					}
				}
			});

		});




		// Modal 열기 버튼 클릭 이벤트 핸들러
		mainboard.on('click', '.show-details', function () {
			var boardid = $(this).data('boardid');
			showDetail(boardid);
		});

	});
</script>